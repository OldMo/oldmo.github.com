---
layout: post
title: "TCP/IP服务器端程序"
description: ""
category: 工作生涯
tags: [TCP/IP]
---

###同步和异步
同步  

服务器只能一个接着一个响应客户端请求，如果前一个客户端的请求未处理完成，此时再进来其他的客户端请求，这些后来的请求则只能等待。  

异步  

服务器能够同时相应多个客户端，只要客户端发起连接，服务器就能并行处理，跟其他客户端操作是否完成没有关系。异步方法通过  
    BeginAcceptTcpClient()
    EndAcceptTcpClient()
两个操作来完成。

###一些概念
CLR  

委托  

AsyncCallback委托

public delegate void AsyncCallback(
        IAsyncResult ar
)

ar是异步操作的结果

AsyncCallback 委托表示在异步操作完成时调用的回调方法，该回调方法的是参数为IAsyncResult，该参数用来获取异步操作的结果。
BeginInvoke
用于开启异步调用，第一个参数与异步调用中执行的方法参数相同，返回IAsyncResult,这个结果用于监视异步调用进度
EndInvoke
检索异步调用结果，调用BeginInvoke后可随时调用EndInvoke，如果异步调用为完成，EndInvoke将一直阻止调用线程，知道异步调用完成后才允许调用线程执行。
BeginAcceptTcpClient
开始一个异步操作来接受一个传入的连接尝试

public IAsyncResult BeginAcceptTcpClient(
        AsyncCallback callback,
        Object state
)

callback是一个委托，用来引用异步操作完成时要调用到的方法

state是用户定义对象，操作完成时会通过callback传递给调用的方法

EndAcceptTcpClient

public TcpClient EndAcceptTcpClient(
        IAsyncResult asyncResult
)

asyncResult是BeginAcceptTcpClient的返回

异步接受传入的连接，创建新的TcpClient处理远程主机的通信，相当于是建立了一个连接之后，建立了一个client来进行发送和接收数据的通信
IAsyncResult
它表示异步操作的状态，其中的一个成员AsyncState用于获取用户定义的对象，它限定或包含关于异步操作的信息；异步调用完成时，WaitHandle 会收到信号
